package com.example.plantsandhabits

import android.content.Context
import androidx.room.Database
import androidx.room.Room
import androidx.room.RoomDatabase
import androidx.room.migration.Migration
import androidx.sqlite.db.SupportSQLiteDatabase
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext

@Database(
    entities = [Category::class, Plant::class, UserPlant::class, Reminder::class, PlantPhoto::class],
    version = 4,
    exportSchema = false
)
abstract class AppDatabase : RoomDatabase() {
    abstract fun plantDao(): PlantDao

    companion object {
        @Volatile
        private var INSTANCE: AppDatabase? = null

        fun getDatabase(context: Context): AppDatabase {
            return INSTANCE ?: synchronized(this) {
                val instance = Room.databaseBuilder(
                    context.applicationContext,
                    AppDatabase::class.java,
                    "plants_database"
                )
                    .addMigrations(MIGRATION_1_2, MIGRATION_2_3, MIGRATION_3_4)
                    .addCallback(AppDatabaseCallback(context))
                    .build()
                INSTANCE = instance
                instance
            }
        }

        private val MIGRATION_1_2 = object : Migration(1, 2) {
            override fun migrate(database: SupportSQLiteDatabase) {
                database.execSQL("ALTER TABLE user_plants ADD COLUMN plantType TEXT")
            }
        }

        private val MIGRATION_2_3 = object : Migration(2, 3) {
            override fun migrate(database: SupportSQLiteDatabase) {
                database.execSQL(
                    """
                    CREATE TABLE IF NOT EXISTS reminders(
                        id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
                        userPlantId INTEGER NOT NULL,
                        workType TEXT NOT NULL,
                        periodValue INTEGER NOT NULL,
                        periodUnit TEXT NOT NULL,
                        hour INTEGER NOT NULL,
                        minute INTEGER NOT NULL,
                        nextTriggerAt INTEGER NOT NULL,
                        FOREIGN KEY(userPlantId) REFERENCES user_plants(id) ON DELETE CASCADE
                    )
                    """.trimIndent()
                )
            }
        }

        private val MIGRATION_3_4 = object : Migration(3, 4) {
            override fun migrate(database: SupportSQLiteDatabase) {
                database.execSQL(
                    """
                    CREATE TABLE IF NOT EXISTS plant_photos(
                        id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
                        userPlantId INTEGER NOT NULL,
                        photoPath TEXT NOT NULL,
                        dateAdded INTEGER NOT NULL,
                        FOREIGN KEY(userPlantId) REFERENCES user_plants(id) ON DELETE CASCADE
                    )
                    """.trimIndent()
                )
            }
        }

        private class AppDatabaseCallback(
            private val context: Context
        ) : RoomDatabase.Callback() {

            override fun onCreate(db: SupportSQLiteDatabase) {
                super.onCreate(db)
                // Этот метод вызывается ТОЛЬКО при первом создании БД
                CoroutineScope(Dispatchers.IO).launch {
                    populateDatabase()
                }
            }

            override fun onOpen(db: SupportSQLiteDatabase) {
                super.onOpen(db)
                // Этот метод вызывается при каждом открытии БД
                // Проверяем и добавляем недостающие категории и растения
                CoroutineScope(Dispatchers.IO).launch {
                    ensureCategoriesExist()
                    ensurePlantsExist()
                }
            }

            /**
             * Проверяет наличие всех необходимых категорий и добавляет недостающие
             */
            private suspend fun ensureCategoriesExist() {
                val database = getDatabase(context)
                val dao = database.plantDao()

                // Получаем все существующие категории
                val existingCategories = dao.getAllCategories()
                val existingCategoriesMap = existingCategories.associateBy { it.name }

                // Список всех необходимых категорий
                val requiredCategories = listOf(
                    Category(name = "Цветущие", imageResName = "ic_flowering"),
                    Category(name = "Лиственные", imageResName = "ic_leafy"),
                    Category(name = "Суккуленты", imageResName = "ic_succulent"),
                    Category(name = "Съедобные", imageResName = "ic_edible"),
                    Category(name = "Папоротники", imageResName = "ic_fern")
                )

                // Добавляем новые категории или обновляем параметры существующих
                for (category in requiredCategories) {
                    val existingCategory = existingCategoriesMap[category.name]
                    if (existingCategory == null) {
                        // Категории нет - добавляем
                        dao.insertCategory(category)
                    } else if (existingCategory.imageResName != category.imageResName) {
                        // Категория есть, но параметры изменились - обновляем
                        dao.updateCategoryImage(existingCategory.id, category.imageResName)
                    }
                }
            }

            /**
             * Проверяет наличие всех необходимых растений и добавляет недостающие
             */
            private suspend fun ensurePlantsExist() {
                val database = getDatabase(context)
                val dao = database.plantDao()

                // Сначала убеждаемся, что категории существуют
                ensureCategoriesExist()
                
                // Получаем все существующие растения
                val existingPlants = dao.getAllPlants()
                val existingPlantsMap = existingPlants.associateBy { it.name }

                // Получаем ID категорий для использования при создании растений
                val allCategories = dao.getAllCategories()
                val floweringCategoryId = allCategories.find { it.name == "Цветущие" }?.id ?: 0
                val leafyCategoryId = allCategories.find { it.name == "Лиственные" }?.id ?: 0
                val succulentCategoryId = allCategories.find { it.name == "Суккуленты" }?.id ?: 0
                val edibleCategoryId = allCategories.find { it.name == "Съедобные" }?.id ?: 0
                val fernCategoryId = allCategories.find { it.name == "Папоротники" }?.id ?: 0

                // Получаем список всех необходимых растений
                val requiredPlants = getAllRequiredPlants(
                    floweringCategoryId,
                    leafyCategoryId,
                    succulentCategoryId,
                    edibleCategoryId,
                    fernCategoryId
                )

                // Добавляем новые растения или обновляем параметры существующих
                for (plant in requiredPlants) {
                    val existingPlant = existingPlantsMap[plant.name]
                    if (existingPlant == null) {
                        // Растения нет - добавляем
                        dao.insertPlant(plant)
                    } else {
                        // Проверяем, изменились ли какие-либо параметры
                        val hasChanges = existingPlant.categoryId != plant.categoryId ||
                                existingPlant.scientificName != plant.scientificName ||
                                existingPlant.description != plant.description ||
                                existingPlant.careTips != plant.careTips ||
                                existingPlant.imageResName != plant.imageResName
                        
                        if (hasChanges) {
                            // Растение есть, но параметры изменились - обновляем все поля
                            dao.updatePlant(
                                existingPlant.id,
                                plant.categoryId,
                                plant.scientificName,
                                plant.description,
                                plant.careTips,
                                plant.imageResName
                            )
                        }
                    }
                }

                // Проверяем наличие placeholder для ручных растений
                val existingPlaceholder = dao.getManualPlantPlaceholder()
                if (existingPlaceholder == null && floweringCategoryId != 0) {
                    dao.insertPlant(
                        Plant(
                            categoryId = floweringCategoryId,
                            name = "_MANUAL_PLACEHOLDER_",
                            scientificName = null,
                            description = "",
                            careTips = "",
                            imageResName = "sample_category"
                        )
                    )
                }
            }

            /**
             * Возвращает список всех необходимых растений
             * Добавляйте сюда новые растения для автоматического добавления при запуске
             */
            private fun getAllRequiredPlants(
                floweringCategoryId: Int,
                leafyCategoryId: Int,
                succulentCategoryId: Int,
                edibleCategoryId: Int,
                fernCategoryId: Int
            ): List<Plant> {
                return listOf(
                    // Цветущие растения
                    Plant(
                        categoryId = floweringCategoryId,
                        name = "Фиалка (Сенполия)",
                        scientificName = "Saintpaulia",
                        description = "Фиалка — компактное комнатное растение с аккуратной розеткой бархатистых, округлых листьев тёмно-зелёного цвета. Листья слегка опушённые, на длинных черешках. Цветки небольшие, но многочисленные, собраны в рыхлые соцветия. Окраска может быть фиолетовой, розовой, белой, синей, бордовой и даже двухцветной. При хорошем уходе цветёт почти круглый год, что делает её одним из самых популярных комнатных растений.",
                        careTips = "• Полив: умеренный, тёплой отстоянной водой. Поливать лучше через поддон или аккуратно под корень, избегая попадания воды на листья\n" +
                                "• Освещение: яркий рассеянный свет; прямые солнечные лучи вызывают ожоги. Хорошо подходит восточное или северо-восточное окно.\n" +
                                "• Пересадка: 1 раз в год или по мере разрастания; горшок должен быть небольшим.\n" +
                                "• Удобрение: раз в 2–3 недели удобрениями для цветущих растений с повышенным содержанием фосфора.\n" +
                                "• Особые условия: не любит сквозняки и резкие перепады температуры; оптимальная температура — 20–24 °C."
                        ,
                        imageResName = "ic_saintpaulia"
                    ),
                    Plant(
                        categoryId = floweringCategoryId,
                        name = "Орхидея фаленопсис",
                        scientificName = "Phalaenopsis",
                        description = "Фаленопсис — одна из самых популярных орхидей для дома. Имеет плотные, мясистые, продолговатые листья насыщенного зелёного цвета. Цветоносы длинные, дугообразные, с крупными цветками, напоминающими бабочек. Окраска цветов варьируется от белой и розовой до фиолетовой, жёлтой и пятнистой. Цветение может длиться несколько месяцев.",
                        careTips = "• Полив: примерно 1 раз в 7–10 дней методом погружения горшка в воду на 10–15 минут.\n" +
                                "• Освещение: яркий рассеянный свет; избегать прямого солнца.\n" +
                                "• Пересадка: каждые 2–3 года в специальный субстрат для орхидей.\n" +
                                "• Удобрение: раз в 2 недели удобрением для орхидей в период активного роста.\n" +
                                "• Особые условия: любит повышенную влажность воздуха и хорошую вентиляцию; корни должны «дышать».",
                        imageResName = "ic_phalaenopsis"
                    ),
                    Plant(
                        categoryId = floweringCategoryId,
                        name = "Гибискус",
                        scientificName = "Hibiscus rosa-sinensis",
                        description = "Гибискус — крупное кустовидное растение с глянцевыми, тёмно-зелёными, заострёнными листьями. Цветки большие, яркие, до 10–15 см в диаметре, чаще всего красные, но встречаются розовые, жёлтые и оранжевые оттенки. Каждый цветок живёт всего 1–2 дня, но при хорошем уходе растение постоянно образует новые бутоны.",
                        careTips = "• Полив: обильный в тёплое время года, зимой умеренный; почва должна быть постоянно слегка влажной.\n" +
                                "• Освещение: яркий свет, допускается прямое солнце утром и вечером.\n" +
                                "• Пересадка: молодые растения — ежегодно, взрослые — раз в 2–3 года.\n" +
                                "• Удобрение: с весны по осень каждые 2 недели комплексным удобрением.\n" +
                                "• Особые условия: любит свежий воздух и регулярную обрезку для формирования кроны.",
                        imageResName = "ic_hibiscus"
                    ),
                    Plant(
                        categoryId = floweringCategoryId,
                        name = "Антуриум",
                        scientificName = "Anthurium andraeanum",
                        description = "Антуриум отличается эффектным внешним видом. Имеет крупные, плотные, сердцевидные листья насыщенного зелёного цвета. Цветки представляют собой початок, окружённый ярким глянцевым покрывалом красного, розового, белого или зелёного оттенка. Цветение продолжительное, часто несколько месяцев подряд.",
                        careTips = "• Полив: умеренный, почва должна быть слегка влажной, без застоя воды.\n" +
                                "• Освещение: яркий рассеянный свет; в тени цветение ослабевает.\n" +
                                "• Пересадка: раз в 2 года в рыхлый, воздухопроницаемый субстрат.\n" +
                                "• Удобрение: раз в 2–3 недели удобрением для ароидных или цветущих растений.\n" +
                                "• Особые условия: требует высокой влажности воздуха (60–80 %), чувствителен к холодному воздуху.",
                        imageResName = "ic_anthurium"
                    ),
                    Plant(
                        categoryId = floweringCategoryId,
                        name = "Бегония декоративно-цветущая",
                        scientificName = "Begonia × semperflorens-cultorum",
                        description = "Цветущая бегония — компактное растение с мясистыми стеблями и асимметричными листьями. Листья могут быть зелёными, бронзовыми или с красноватым оттенком. Цветки небольшие, но многочисленные, бывают белыми, розовыми, красными и оранжевыми. Цветёт продолжительно, особенно при хорошем освещении.",
                        careTips = "• Полив: регулярный, но умеренный; не допускать переувлажнения.\n" +
                                "• Освещение: яркий рассеянный свет, лёгкая полутень допустима.\n" +
                                "• Пересадка: по мере роста, обычно раз в 1–2 года.\n" +
                                "• Удобрение: каждые 2 недели удобрениями для цветущих растений.\n" +
                                "• Особые условия: не любит опрыскивание листьев и резкие перепады температуры.",
                        imageResName = "ic_begonia"
                    ),
                    // Лиственные растения
                    Plant(
                        categoryId = leafyCategoryId,
                        name = "Фикус Бенджамина",
                        scientificName = "Ficus benjamina",
                        description = "Фикус Бенджамина — популярное декоративно-лиственное растение в виде небольшого деревца или куста. Имеет тонкие, гибкие ветви и множество мелких овальных листьев с заострённым кончиком. Листья гладкие, глянцевые, могут быть однотонно-зелёными или пёстрыми (с кремовыми или белыми краями). Растение ценится за изящный внешний вид и способность формировать крону.",
                        careTips = "• Полив: умеренный; поливать после подсыхания верхнего слоя почвы. Избыток воды приводит к опадению листьев.\n" +
                                "• Освещение: яркий рассеянный свет; пёстрые формы требуют более хорошего освещения.\n" +
                                "• Пересадка: молодые растения — ежегодно, взрослые — раз в 2–3 года.\n" +
                                "• Удобрение: с весны по осень каждые 2–3 недели удобрением для декоративно-лиственных растений.\n" +
                                "• Особые условия: не любит перемещения, сквозняки и резкие перепады температуры.",
                        imageResName = "ic_ficus"
                    ),
                    Plant(
                        categoryId = leafyCategoryId,
                        name = "Монстера",
                        scientificName = "Monstera deliciosa",
                        description = "Монстера — крупное эффектное растение с мощными стеблями и большими кожистыми листьями. Листья тёмно-зелёные, блестящие, с характерными прорезями и отверстиями, которые увеличиваются с возрастом растения. Часто образует воздушные корни. Используется как акцентное растение в просторных помещениях.",
                        careTips = "• Полив: регулярный, умеренный; почва должна быть слегка влажной.\n" +
                                "• Освещение: яркий рассеянный свет, переносит полутень.\n" +
                                "• Пересадка: молодые растения — ежегодно, взрослые — раз в 2–3 года.\n" +
                                "• Удобрение: каждые 2 недели в период активного роста комплексным удобрением.\n" +
                                "• Особые условия: нуждается в опоре и повышенной влажности воздуха; полезно протирать листья.",
                        imageResName = "ic_monstera"
                    ),
                    Plant(
                        categoryId = leafyCategoryId,
                        name = "Драцена окаймлённая",
                        scientificName = "Dracaena marginata",
                        description = "Драцена — стройное растение с тонким стволом и пучками узких, длинных листьев. Листья жёсткие, заострённые, зелёные с красноватой или пурпурной каймой. Внешне напоминает пальму, но занимает меньше места. Часто используется в офисах и квартирах благодаря неприхотливости.",
                        careTips = "• Полив: умеренный; избыток влаги может вызвать загнивание корней.\n" +
                                "• Освещение: яркий рассеянный свет, но хорошо растёт и в полутени.\n" +
                                "• Пересадка: раз в 2–3 года.\n" +
                                "• Удобрение: 1–2 раза в месяц в тёплый период года.\n" +
                                "• Особые условия: не переносит холод и сквозняки; любит повышенную влажность воздуха.",
                        imageResName = "ic_dracaena"
                    ),
                    Plant(
                        categoryId = leafyCategoryId,
                        name = "Спатифиллум",
                        scientificName = "Spathiphyllum",
                        description = "Спатифиллум — компактное лиственное растение с удлинёнными, ланцетными листьями насыщенного зелёного цвета. Листья растут из прикорневой розетки. Хотя растение цветёт белыми покрывалами, его часто относят к лиственным из-за декоративности листвы. Листья глянцевые, выразительные, создают аккуратный куст.",
                        careTips = "• Полив: регулярный; растение плохо переносит пересыхание почвы.\n" +
                                "• Освещение: полутень или рассеянный свет, прямое солнце нежелательно.\n" +
                                "• Пересадка: раз в 1–2 года весной.\n" +
                                "• Удобрение: каждые 2–3 недели в период роста.\n" +
                                "• Особые условия: любит высокую влажность воздуха и тепло; сигнализирует о нехватке воды поникающими листьями.",
                        imageResName = "ic_spathiphyllum"
                    ),
                    Plant(
                        categoryId = leafyCategoryId,
                        name = "Хлорофитум",
                        scientificName = "Chlorophytum comosum",
                        description = "Хлорофитум — неприхотливое травянистое растение с длинными узкими листьями, собранными в розетку. Листья зелёные или пёстрые с белыми полосами. Образует длинные цветоносы с «детками», благодаря чему легко размножается. Известен способностью очищать воздух.",
                        careTips = "• Полив: умеренный, но регулярный; легко переносит кратковременную засуху.\n" +
                                "• Освещение: яркий рассеянный свет, но может расти и в полутени.\n" +
                                "• Пересадка: по мере разрастания корней, обычно раз в 1–2 года.\n" +
                                "• Удобрение: 1–2 раза в месяц в период активного роста.\n" +
                                "• Особые условия: крайне неприхотлив; подходит для начинающих и помещений с нестабильными условиями.",
                        imageResName = "ic_chlorophytum"
                    ),
                    // Кактусы и суккуленты
                    Plant(
                        categoryId = succulentCategoryId,
                        name = "Алоэ Вера",
                        scientificName = "Aloe vera",
                        description = "Алоэ вера — многолетний суккулент с плотными, мясистыми листьями, собранными в прикорневую розетку. Листья продолговатые, заострённые, серо-зелёного цвета, по краям покрыты мелкими зубчиками. Внутри листьев содержится прозрачный гелеобразный сок. Растение декоративное, но часто выращивается также из-за своих полезных свойств.",
                        careTips = "• Полив: редкий; поливать только после полного просыхания почвы. Зимой полив минимальный.\n" +
                                "• Освещение: яркий солнечный свет; хорошо переносит прямые лучи.\n" +
                                "• Пересадка: раз в 2–3 года весной.\n" +
                                "• Удобрение: 1–2 раза за сезон удобрением для суккулентов.\n" +
                                "• Особые условия: не переносит переувлажнения и холодных температур ниже 10 °C.",
                        imageResName = "ic_aloe"
                    ),
                    Plant(
                        categoryId = succulentCategoryId,
                        name = "Толстянка (Денежное дерево)",
                        scientificName = "Crassula ovata",
                        description = "Толстянка — суккулент с одревесневающим стволом и округлыми, мясистыми листьями. Листья гладкие, насыщенно-зелёные, иногда с красноватой каймой. По форме растение напоминает миниатюрное дерево, благодаря чему широко используется для формирования бонсай. Отличается медленным ростом и декоративностью.",
                        careTips = "• Полив: умеренный; почва должна полностью высыхать между поливами.\n" +
                                "• Освещение: яркий свет, допускается прямое солнце.\n" +
                                "• Пересадка: раз в 2–3 года.\n" +
                                "• Удобрение: раз в месяц в период роста удобрением для суккулентов.\n" +
                                "• Особые условия: не любит частые поливы и холодные сквозняки.",
                        imageResName = "ic_crassula"
                    ),
                    Plant(
                        categoryId = succulentCategoryId,
                        name = "Эхеверия",
                        scientificName = "Echeveria",
                        description = "Эхеверия — компактный розеточный суккулент с симметрично расположенными мясистыми листьями. Листья могут быть зелёными, сизыми, розоватыми или фиолетовыми, часто покрыты восковым налётом. Растение выглядит очень аккуратно и часто используется в композициях и флорариумах.",
                        careTips = "• Полив: редкий; поливать аккуратно под корень после полного высыхания почвы.\n" +
                                "• Освещение: яркий солнечный свет, желательно южное окно.\n" +
                                "• Пересадка: раз в 2 года.\n" +
                                "• Удобрение: 1–2 раза за сезон слабым раствором удобрения для суккулентов.\n" +
                                "• Особые условия: не переносит застоя воды и попадания влаги в центр розетки.",
                        imageResName = "ic_echeveria"
                    ),
                    Plant(
                        categoryId = succulentCategoryId,
                        name = "Хавортия",
                        scientificName = "Haworthia",
                        description = "Хавортия — небольшой суккулент с плотными, треугольными листьями, собранными в розетку. Листья тёмно-зелёные, часто украшены белыми полосками или точками. Растение компактное, медленно растущее, идеально подходит для подоконников и небольших помещений.",
                        careTips = "• Полив: умеренный; поливать после высыхания почвы, зимой редко.\n" +
                                "• Освещение: яркий рассеянный свет; прямое солнце может вызывать ожоги.\n" +
                                "• Пересадка: раз в 2–3 года.\n" +
                                "• Удобрение: 1 раз в месяц в тёплый период года.\n" +
                                "• Особые условия: предпочитает стабильную температуру и хорошую вентиляцию.",
                        imageResName = "ic_haworthia"
                    ),
                    Plant(
                        categoryId = succulentCategoryId,
                        name = "Кактус эхинопсис",
                        scientificName = "Echinopsis",
                        description = "Эхинопсис — шаровидный или слегка вытянутый кактус с выраженными рёбрами и ареолами с колючками. Стебель зелёный, плотный, с возрастом может вытягиваться. Ценится за крупные, эффектные цветки в форме воронки, которые распускаются весной или летом и могут быть белыми, розовыми или кремовыми.",
                        careTips = "• Полив: редкий; летом — после полного высыхания почвы, зимой почти не поливают.\n" +
                                "• Освещение: яркий солнечный свет, желательны прямые лучи.\n" +
                                "• Пересадка: раз в 2–3 года.\n" +
                                "• Удобрение: 1–2 раза за сезон удобрением для кактусов.\n" +
                                "• Особые условия: для цветения необходим период покоя зимой при температуре 8–12 °C.",
                        imageResName = "ic_echinopsis"
                    ),
                    // Съедобные
                    Plant(
                        categoryId = edibleCategoryId,
                        name = "Базилик",
                        scientificName = "Ocimum basilicum",
                        description = "Базилик — ароматное травянистое растение с прямостоячими стеблями и овальными, слегка заострёнными листьями. Листья гладкие, насыщенно-зелёные или фиолетовые (в зависимости от сорта), обладают ярким пряным ароматом. Растение компактное, быстрорастущее, хорошо подходит для выращивания на подоконнике и часто используется в кулинарии в свежем виде.",
                        careTips = "• Полив: регулярный и умеренный; почва должна быть постоянно слегка влажной, но без застоя воды.\n" +
                                "• Освещение: яркий свет, не менее 10–12 часов в день; зимой желательно досвечивание.\n" +
                                "• Пересадка: по мере роста, обычно через 1–2 месяца после посева.\n" +
                                "• Удобрение: раз в 2 недели комплексным удобрением для зелени.\n" +
                                "• Особые условия: любит тепло (18–25 °C), не переносит сквозняков; регулярная прищипка стимулирует рост.",
                        imageResName = "ic_basilicum"
                    ),
                    Plant(
                        categoryId = edibleCategoryId,
                        name = "Мята",
                        scientificName = "Mentha spicata",
                        description = "Мята — многолетнее травянистое растение с прямыми или слегка стелющимися стеблями и продолговатыми зубчатыми листьями. Листья ярко-зелёные, ароматные, с характерным освежающим запахом. Растение быстро разрастается, образуя пышный куст, и используется для напитков, десертов и чая.",
                        careTips = "• Полив: регулярный, почва должна быть умеренно влажной.\n" +
                                "• Освещение: яркий рассеянный свет или лёгкая полутень.\n" +
                                "• Пересадка: раз в год или при сильном разрастании.\n" +
                                "• Удобрение: 1 раз в месяц органическим или минеральным удобрением.\n" +
                                "• Особые условия: требует регулярной обрезки; желательно выращивать в отдельном горшке из-за активного роста корней.",
                        imageResName = "ic_mentha"
                    ),
                    Plant(
                        categoryId = edibleCategoryId,
                        name = "Зелёный лук",
                        scientificName = "Allium cepa",
                        description = "Зелёный лук — одно из самых простых и популярных съедобных растений для дома. Представляет собой пучок полых трубчатых листьев ярко-зелёного цвета. Быстро отрастает после срезки и может выращиваться как в почве, так и в воде. Используется в свежем виде в салатах и горячих блюдах.",
                        careTips = "• Полив: регулярный; почва должна быть постоянно слегка влажной.\n" +
                                "• Освещение: яркий свет, желательно солнечное окно.\n" +
                                "• Пересадка: не требуется при выращивании из луковиц.\n" +
                                "• Удобрение: при выращивании в почве — 1 раз в месяц.\n" +
                                "• Особые условия: хорошо растёт при температуре 18–22 °C; рекомендуется регулярный сбор пера.",
                        imageResName = "ic_cepa"
                    ),
                    Plant(
                        categoryId = edibleCategoryId,
                        name = "Перец чили (комнатный)",
                        scientificName = "Capsicum annuum",
                        description = "Комнатный перец чили — компактный куст с крепкими стеблями и гладкими, заострёнными листьями. Во время плодоношения растение может быть декоративным: на нём одновременно могут быть цветки и плоды разной окраски — от зелёной до красной. Плоды съедобные, острые, используются в свежем и сушёном виде.",
                        careTips = "• Полив: умеренный, регулярный; пересыхание почвы нежелательно.\n" +
                                "• Освещение: яркий свет, не менее 12 часов в день.\n" +
                                "• Пересадка: 1 раз за сезон или при разрастании корней.\n" +
                                "• Удобрение: каждые 2 недели удобрением для плодовых растений.\n" +
                                "• Особые условия: хлюбит тепло и свежий воздух; для лучшего плодоношения полезно ручное опыление.",
                        imageResName = "ic_capsicum"
                    ),
                    Plant(
                        categoryId = edibleCategoryId,
                        name = "Петрушка",
                        scientificName = "Petroselinum crispum",
                        description = "Петрушка — травянистое растение с густой розеткой рассечённых, ярко-зелёных листьев. Листья ароматные, сочные, используются в свежем виде как приправа. Растение компактное, хорошо переносит регулярную срезку и подходит для круглогодичного выращивания на подоконнике.",
                        careTips = "• Полив: регулярный, умеренный; пересыхание почвы замедляет рост.\n" +
                                "• Освещение: яркий свет или лёгкая полутень.\n" +
                                "• Пересадка: обычно не требуется при выращивании из семян в постоянном горшке.\n" +
                                "• Удобрение: 1–2 раза в месяц удобрением для зелёных культур.\n" +
                                "• Особые условия: предпочитает прохладные условия (16–20 °C); семена всходят медленно.",
                        imageResName = "ic_petroselinum"
                    ),
                    // Папоротниковые
                    Plant(
                        categoryId = fernCategoryId,
                        name = "Нефролепис возвышенный",
                        scientificName = "Nephrolepis exaltata",
                        description = "Нефролепис — один из самых распространённых комнатных папоротников. Образует пышную розетку из длинных дугообразных вай (листьев), состоящих из множества мелких сегментов. Листья светло- или ярко-зелёные, мягкие на ощупь, создают эффект густой зелёной «шапки». Растение хорошо смотрится в подвесных кашпо и на подставках.",
                        careTips = "• Полив: регулярный и обильный; почва должна быть постоянно слегка влажной, без застоя воды.\n" +
                                "• Освещение: рассеянный свет или полутень; прямые солнечные лучи вредны.\n" +
                                "• Пересадка: раз в 1–2 года весной.\n" +
                                "• Удобрение: раз в 2–3 недели слабым раствором удобрения для декоративно-лиственных растений.\n" +
                                "• Особые условия: требует высокой влажности воздуха; полезны частые опрыскивания.",
                        imageResName = "ic_nephrolepis"
                    ),
                    Plant(
                        categoryId = fernCategoryId,
                        name = "Адиантум",
                        scientificName = "Adiantum",
                        description = "Адиантум — изящный папоротник с тонкими тёмными черешками и мелкими вееровидными сегментами листьев. Листья светло-зелёные, нежные, создают воздушный, ажурный вид. Считается одним из самых декоративных, но и более требовательных папоротников для домашнего выращивания.",
                        careTips = "• Полив: частый; почва должна быть постоянно влажной, пересыхание губительно.\n" +
                                "• Освещение: полутень или рассеянный свет.\n" +
                                "• Пересадка: раз в 1–2 года.\n" +
                                "• Удобрение: 1 раз в месяц слабым раствором удобрения.\n" +
                                "• Особые условия: уждается в высокой влажности воздуха и защите от сухого воздуха и сквозняков.",
                        imageResName = "ic_adiantum"
                    ),
                    Plant(
                        categoryId = fernCategoryId,
                        name = "Платицериум",
                        scientificName = "Platycerium bifurcatum",
                        description = "Платицериум — необычный папоротник с листьями, напоминающими оленьи рога. Имеет два типа вай (листьев): стерильные (округлые, прижимающиеся к основанию) и спороносные (длинные, разветвлённые). Часто выращивается как ампельное растение или закрепляется на корягах и декоративных панелях. Очень эффектен в интерьере.",
                        careTips = "• Полив: умеренный; лучше поливать методом погружения.\n" +
                                "• Освещение: яркий рассеянный свет.\n" +
                                "• Пересадка: редко, только при необходимости.\n" +
                                "• Удобрение: раз в месяц слабым раствором удобрения.\n" +
                                "• Особые условия: высокая влажность воздуха и хорошая циркуляция воздуха без сквозняков.",
                        imageResName = "ic_platycerium"
                    ),
                    Plant(
                        categoryId = fernCategoryId,
                        name = "Асплениум гнездовой",
                        scientificName = "Asplenium nidus",
                        description = "Асплениум отличается цельными, широкими, ремневидными листьями с волнистыми краями. Листья ярко-зелёные, блестящие, собраны в плотную розетку, напоминающую гнездо. В отличие от многих папоротников, не имеет рассечённых листьев, что делает его легко узнаваемым.",
                        careTips = "• Полив: регулярный, умеренный; почва должна быть постоянно слегка влажной.\n" +
                                "• Освещение: рассеянный свет или полутень.\n" +
                                "• Пересадка: раз в 2–3 года.\n" +
                                "• Удобрение: раз в месяц в период роста.\n" +
                                "• Особые условия: не любит попадания воды в центр розетки; требует высокой влажности воздуха.",
                        imageResName = "ic_asplenium"
                    ),
                    Plant(
                        categoryId = fernCategoryId,
                        name = "Птерис критский",
                        scientificName = "Pteris cretica",
                        description = "Птерис — компактный папоротник с перистыми листьями, разделёнными на узкие сегменты. Листья светло-зелёные, у некоторых сортов имеют светлую продольную полосу. Растение выглядит аккуратно и декоративно, подходит для выращивания в горшках и композициях.",
                        careTips = "• Полив: регулярный; почва должна быть постоянно слегка влажной.\n" +
                                "• Освещение: яркий рассеянный свет.\n" +
                                "• Пересадка: раз в 1–2 года.\n" +
                                "• Удобрение: раз в 2–3 недели в период активного роста.\n" +
                                "• Особые условия: чувствителен к сухому воздуху и холодным сквознякам.",
                        imageResName = "ic_pteris"
                    )
                )
            }

            private suspend fun populateDatabase() {
                // Используем ensurePlantsExist для консистентности
                // Это создаст все категории и растения при первом запуске
                ensurePlantsExist()
            }
        }
    }
}